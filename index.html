<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>解憂市集 Wellness Market</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF7;
        }
        
        .font-serif {
            font-family: 'Noto Serif TC', serif;
        }

        /* 自定義紋理背景 */
        .bg-texture {
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d6d3d1' fill-opacity='0.4' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='1'/%3E%3Ccircle cx='13' cy='13' r='1'/%3E%3C/g%3E%3C/svg%3E");
        }

        /* 動畫效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleUp {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .animate-scale-up {
            animation: scaleUp 0.3s ease-out forwards;
        }

        /* 新增：明顯跳動動畫 */
        @keyframes bounce-subtle {
            0%, 100% {
                transform: translateY(-15%); /* 明顯上移 */
            }
            50% {
                transform: translateY(0); /* 回到原位 */
            }
        }
        .animate-subtle-bounce {
            animation: bounce-subtle 1.5s infinite ease-in-out; /* 中速、無限、明顯的跳動 */
        }
        
        /* 隱藏滾動條但保留功能 (Modal開啟時) */
        .no-scroll {
            overflow: hidden;
        }
        
        ::selection {
            background-color: #FEF3C7; /* amber-100 */
        }
    </style>
</head>
<body class="text-stone-800 min-h-screen flex items-center justify-center p-4 md:p-8">

    <!-- 16:9 主容器 -->
    <div class="w-full max-w-[1400px] aspect-video relative flex flex-col bg-[#FDFBF7] shadow-2xl rounded-xl overflow-hidden border-4 border-white ring-1 ring-stone-200/50">
        
        <!-- 背景裝飾元素 -->
        <div class="absolute inset-0 bg-texture opacity-30 pointer-events-none"></div>
        <div class="absolute top-0 left-0 w-full h-1/3 bg-gradient-to-b from-blue-50/80 to-transparent -z-0"></div>
        <div class="absolute -top-10 right-10 text-blue-100/60 rotate-12">
            <i data-lucide="cloud-rain" width="140" height="140"></i>
        </div>
        <div class="absolute top-10 left-10 text-amber-100/60 -rotate-12">
            <i data-lucide="sun" width="100" height="100"></i>
        </div>

        <!-- 頁首 -->
        <header class="relative z-10 pt-10 pb-4 text-center">
            <div class="inline-block relative">
                <h1 class="text-3xl md:text-5xl font-serif font-bold tracking-widest text-stone-800 mb-2">解憂市集</h1>
                <div class="h-1.5 w-full bg-amber-300/50 rounded-full mt-1"></div>
                <div class="absolute -top-5 -right-5 text-amber-400/80 rotate-12 hidden md:block">
                    <i data-lucide="smile" width="36" height="36"></i>
                </div>
            </div>
            <p class="text-stone-500 mt-3 font-light tracking-wider text-sm md:text-base">
                逛逛攤位，點選你需要的「解憂小物」。 Pick your own “stress relievers".
            </p>
        </header>

        <!-- 主要市集區域 (Grid) -->
        <main class="flex-1 relative z-10 flex items-end justify-center pb-16 px-6 md:px-16">
            <!-- 地面裝飾 -->
            <div class="absolute bottom-0 left-0 w-full h-24 bg-[#F0EFE9] border-t-2 border-stone-200/50"></div>
            
            <!-- 攤位容器 -->
            <div id="market-grid" class="w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 lg:gap-6 max-w-6xl relative items-end">
                <!-- Javascript 將在此渲染攤位 -->
            </div>
        </main>

        <!-- 頁尾 -->
        <footer class="relative z-10 bg-white/60 backdrop-blur-md py-2 text-center border-t border-stone-100 text-[10px] text-stone-400 tracking-widest">
            <p></p>
        </footer>
    </div>

    <!-- 彈出視窗 (Modal) -->
    <div id="book-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-stone-900/60 backdrop-blur-md opacity-0 transition-opacity duration-300" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div id="modal-content" class="bg-[#FDFBF7] rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden relative transform scale-95 transition-transform duration-300 border-4 border-white">
            <!-- 關閉按鈕 -->
            <button onclick="closeModal()" class="absolute top-4 right-4 p-2 hover:bg-stone-200/50 rounded-full transition-colors text-stone-500 z-10">
                <i data-lucide="x" width="24" height="24"></i>
            </button>

            <div class="flex flex-col md:flex-row">
                <!-- 左側：書封與 QR Code -->
                <div class="bg-stone-100 p-8 md:w-2/5 flex flex-col items-center justify-center text-center border-r border-stone-200 relative overflow-hidden">
                    <div class="absolute inset-0 bg-texture opacity-10 pointer-events-none"></div>
                    
                    <!-- 實際書封圖片 -->
                    <div class="w-32 h-48 bg-white border-2 border-stone-200 rounded-lg shadow-xl flex items-center justify-center p-1 mb-6 relative transform rotate-2">
                        <img id="modal-book-cover" 
                             src="" 
                             alt="書籍封面" 
                             class="w-full h-full object-contain rounded-lg shadow-md"
                             onerror="this.style.display='none'; document.getElementById('cover-fallback').style.display='flex';"
                        />
                        <!-- 圖片載入失敗的備用顯示 -->
                        <div id="cover-fallback" class="absolute inset-0 flex flex-col items-center justify-center p-4 text-center hidden">
                            <i data-lucide="book-open" class="text-stone-300 mb-2" width="40" height="40"></i>
                            <p id="modal-book-title-cover" class="text-xs text-stone-400 font-serif line-clamp-2">封面載入失敗</p>
                        </div>
                        <div class="absolute -left-0.5 top-0 h-full w-1 bg-stone-300 rounded-l-sm"></div>
                    </div>

                    <div class="bg-white p-3 rounded-xl shadow-sm">
                        <div class="bg-white rounded shadow-sm inline-block w-24 h-24">
                             <img id="modal-qrcode" src="" alt="QR Code" class="w-full h-full mix-blend-multiply" />
                        </div>
                        <p class="text-[10px] text-stone-500 mt-2 tracking-wider">掃描閱讀電子書</p>
                    </div>
                </div>

                <!-- 右側：書籍資訊 -->
                <div class="p-8 md:w-3/5 flex flex-col justify-center relative">
                    <div class="flex items-center gap-2 text-amber-600 mb-2 opacity-60">
                        <i data-lucide="bird" width="18" height="18"></i>
                        <span class="text-xs tracking-widest">解憂書單推薦</span>
                    </div>
                    <h2 id="modal-book-title" class="font-serif text-2xl font-bold text-stone-800 mb-2">書名</h2>
                    <p id="modal-book-author" class="text-sm text-stone-500 mb-6">作者</p>

                    <div class="relative p-6 bg-white rounded-xl shadow-sm border border-stone-100">
                        <div class="absolute -top-3 left-4 text-stone-300">
                            <i data-lucide="feather" width="24" height="24"></i>
                        </div>
                        <p class="text-stone-700 italic font-serif leading-relaxed">
                            「<span id="modal-book-quote">名言</span>」
                        </p>
                    </div>
                    
                    <!-- 移除 "在手機上開啟閱讀" 按鈕，只保留主要內容 -->
                    <!-- <a id="modal-book-link" href="#" target="_blank" rel="noreferrer" class="mt-8 flex items-center justify-center gap-2 bg-stone-800 text-white py-3 px-6 rounded-full hover:bg-stone-700 transition-colors group">
                        <i data-lucide="smartphone" class="group-hover:animate-pulse" width="18" height="18"></i>
                        <span class="text-sm font-medium tracking-wide">在手機上開啟閱讀</span>
                    </a> -->
                    <p class="mt-8 text-center text-stone-500 text-xs tracking-wider">請掃描左側 QR Code 閱讀</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 資料數據：包含封面 URL 和 QR Code 連結
        const MARKET_DATA = [
          {
            id: 'store',
            name: '減壓推薦 Stress Relief',
            subtitle: '最近有壓力?歡迎看看。Stressful? Feel free to have a look',
            color: 'bg-amber-50',
            accent: 'border-amber-200',
            textColor: 'text-amber-800',
            icon: 'coffee',
            description: '為忙碌的你，提供暫停的勇氣。',
            items: [
              { 
                  id: 'b1', itemName: '', itemIcon: 'coffee', itemClass: 'text-amber-700', 
                  title: '駕馭沉靜', author: '萊恩.霍利得(Ryan Holiday)', 
                  quote: '平衡身心靈與內外衝突, 通往幸福的情緒練習', 
                  coverUrl: 'https://proxy-ap.hosted.exlibrisgroup.com/exl_rewrite/books.google.com/books/content?id=bsAYEAAAQBAJ&printsec=frontcover&img=1&zoom=5',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002173277204326'
              },
              { 
                  id: 'b2', itemName: '', itemIcon: 'anchor', itemClass: 'text-amber-600', 
                  title: '八成是你想太多', author: '尼克.崔頓(Nick Trenton)', 
                  quote: '你的煩惱不是真正的煩惱, 23個鬆綁焦慮、緩解壓力與享受當下的練習',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202403-ebook_12.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002268752204326'
              },
              { 
                  id: 'b3', itemName: '', itemIcon: 'gift', itemClass: 'text-amber-500', 
                  title: 'No more stress! ', author: 'Gladeana McMahon', 
                  quote: 'Be your own stress management coach',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202403-ebook_3.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002200542304326'
              }
            ]
          },
          {
            id: 'garden',
            name: '一夜好眠 Good Sleep',
            subtitle: '別少看睡眠的重要性!Sleep is important',
            color: 'bg-emerald-50',
            accent: 'border-emerald-200',
            textColor: 'text-emerald-800',
            icon: 'moon',
            description: '這裡有讓靈魂行光合作用的養分。',
            items: [
              { 
                  id: 'b4', itemName: '', itemIcon: 'leaf', itemClass: 'text-emerald-600', 
                  title: '為什麼要睡覺?', author: '沃克(Matthew Walker)', 
                  quote: '睡出健康與學習力、夢出創意的新科學',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202401-ebook_1.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002173149604326'
              },
              { 
                  id: 'b5', itemName: '', itemIcon: 'droplet', itemClass: 'text-emerald-500', 
                  title: '好好睡一覺', author: '拉斐爾.佩拉約醫生(Rafael Pelayo, MD)', 
                  quote: '史丹佛睡眠名醫親授, 一夜好眠的最新科學解決方案',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202401-ebook_2.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002269904404326'
              },
              { 
                  id: 'b6', itemName: '', itemIcon: 'sprout', itemClass: 'text-emerald-700', 
                  title: 'The mystery of sleep', author: 'Meir Kryger', 
                  quote: 'Why a good night rest is vital to a better, healthier life',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202401-ebook_8.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002128297104326'
              }
            ]
          },
          {
            id: 'clinic',
            name: '情緒急救包 Emotional First Aid',
            subtitle: '好好善待自己!Treat yourself well ',
            color: 'bg-slate-50',
            accent: 'border-slate-200',
            textColor: 'text-slate-700',
            icon: 'cloud-rain',
            description: '悲傷也沒關係，這裡是情緒的安全避風港。',
            items: [
              { 
                  id: 'b7', itemName: '', itemIcon: 'puzzle', itemClass: 'text-slate-500', 
                  title: '修復情緒的100個創作練習', author: '莉亞.古茲曼(Leah Guzman)', 
                  quote: '把壓力、焦慮、惶恐、不安轉交給藝術, 卸下傷痛, 撫慰身心',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202403-ebook_11.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002226426004326'
              },
              { 
                  id: 'b8', itemName: '', itemIcon: 'heart-handshake', itemClass: 'text-slate-600', 
                  title: '情緒, 如何療癒', author: '諾曼.萊特(H. Norman Wright)', 
                  quote: '憂慮、憤怒、壓力和憂鬱的15個情緒解答',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202403-ebook_9.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002226454604326'
              },
              { 
                  id: 'b9', itemName: '', itemIcon: 'umbrella', itemClass: 'text-slate-400', 
                  title: '10 steps to mastering stress', author: 'David H. Barlow, Ph.D., Ronald M. Rapee, Ph.D. Sarah Perini, M.A', 
                  quote: 'A lifestyle approach',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/216622/images/202403-ebook_5.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002123152904326'
              }
            ]
          },
          {
            id: 'future',
            name: '正念練習 Practice Mindfulness',
            subtitle: '回歸內在安寧! Stay calm',
            color: 'bg-rose-50',
            accent: 'border-rose-200',
            textColor: 'text-rose-800',
            icon: 'feather',
            description: '在字裡行間，尋找生活的意義與未來的方向。',
            items: [
              { 
                  id: 'b10', itemName: '', itemIcon: 'compass', itemClass: 'text-rose-600', 
                  title: '正念解憂的佛貓', author: '龍悠(Aljoscha Long), 朗諾德.史威普(Ronald Schweppe)', 
                  quote: '喚醒「內觀療癒」力量, 不受困於壓力、煩惱與迷惘的無止循環, 領悟平靜智慧的練習',
                  coverUrl: 'https://proxy-ap.hosted.exlibrisgroup.com/exl_rewrite/books.google.com/books/content?id=aCkwEQAAQBAJ&printsec=frontcover&img=1&zoom=5',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002384210504326'
              },
              { 
                  id: 'b11', itemName: '', itemIcon: 'key', itemClass: 'text-rose-500', 
                  title: '正念減痛', author: '喬.卡巴金(Jon Kabat-Zinn)', 
                  quote: '療癒慢性疼痛, 情緒焦慮, 心理創傷, 正念減壓之父卡巴金的靜觀練習課',
                  coverUrl: 'https://proxy-ap.hosted.exlibrisgroup.com/exl_rewrite/syndetics.com/index.php?client=primo&isbn=9786267299050/lc.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002358808704326'
              },
              { 
                  id: 'b12', itemName: '', itemIcon: 'lightbulb', itemClass: 'text-rose-700', 
                  title: 'Mind clearing', author: 'Alice Whieldon', 
                  quote: 'The key to mindfulness mastery',
                  coverUrl: 'https://libapps-au.s3-ap-southeast-2.amazonaws.com/accounts/206453/images/Mind_Clearing.jpg',
                  qrCodeLink: 'http://lib.hkapa.edu/bib/991002121934804326'
              }
            ]
          }
        ];

        // 渲染市集攤位
        function renderMarket() {
            const container = document.getElementById('market-grid');
            let html = '';

            MARKET_DATA.forEach(stall => {
                // 產生遮雨棚顏色
                const awningColor = stall.color.replace('50', '400');
                
                // 產生遮雨棚 HTML
                let awningHtml = '';
                for(let i=0; i<6; i++) {
                    const bgColor = i % 2 === 0 ? awningColor : 'bg-white';
                    awningHtml += `<div class="flex-1 ${bgColor} rounded-b-full h-4 shadow-sm"></div>`;
                }

                // 產生貨品 HTML
                let itemsHtml = '';
                stall.items.forEach(item => {
                    // 將 item 轉換為 JSON 字符串以便在 onclick 傳遞 (注意引號轉義)
                    const itemData = encodeURIComponent(JSON.stringify(item));
                    
                    itemsHtml += `
                        <div onclick="openModal('${itemData}')" class="flex flex-col items-center cursor-pointer group p-2">
                            <!-- 新增 animate-subtle-bounce 類別來實現跳動效果 -->
                            <div class="bg-white p-3 rounded-full shadow-sm border-2 ${stall.accent} group-hover:-translate-y-1 transition-transform duration-300 relative animate-subtle-bounce">
                                <i data-lucide="${item.itemIcon}" class="${item.itemClass}" width="28" height="28"></i>
                                <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-400 rounded-full animate-pulse border-2 border-white"></div>
                            </div>
                            <span class="mt-2 text-xs font-medium ${stall.textColor} text-center opacity-80 group-hover:opacity-100 transition-opacity">
                                ${item.itemName}
                            </span>
                        </div>
                    `;
                });

                // 組合攤位 HTML
                html += `
                <div class="relative">
                    <!-- 遮雨棚 -->
                    <div class="w-full h-5 flex relative z-10">
                        ${awningHtml}
                    </div>
                    
                    <!-- 攤位本體 -->
                    <div class="${stall.color} ${stall.accent} border-b-4 border-x-2 rounded-b-lg pt-8 pb-4 px-4 h-72 flex flex-col justify-between shadow-lg relative overflow-hidden">
                        
                        <!-- 招牌 -->
                        <div class="text-center mb-4 relative z-10">
                            <div class="inline-flex items-center gap-2 ${stall.textColor} mb-1">
                                <i data-lucide="${stall.icon}" width="32" height="32"></i>
                                <h3 class="font-serif text-xl font-bold">${stall.name}</h3>
                            </div>
                            <p class="text-xs text-gray-500 font-light tracking-wider">${stall.subtitle}</p>
                        </div>

                        <!-- 貨品展示區 (桌子) -->
                        <div class="bg-white/60 rounded-lg p-3 backdrop-blur-sm border border-white/40 shadow-inner relative z-10">
                            <div class="absolute inset-0 bg-stone-100 opacity-20 bg-texture pointer-events-none rounded-lg"></div>
                            <div class="grid grid-cols-3 gap-2 relative z-10">
                                ${itemsHtml}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 支架 -->
                    <div class="flex justify-between px-8 w-full absolute -bottom-5 z-0">
                        <div class="w-3 h-6 bg-stone-300 rounded-b border-x border-stone-400/30"></div>
                        <div class="w-3 h-6 bg-stone-300 rounded-b border-x border-stone-400/30"></div>
                    </div>
                </div>
                `;
            });

            container.innerHTML = html;
        }

        // 開啟彈窗
        function openModal(itemDataEncoded) {
            const item = JSON.parse(decodeURIComponent(itemDataEncoded));
            
            // 1. 更新 Modal 文字內容
            document.getElementById('modal-book-title').textContent = item.title;
            // 備用封面的文字 (如果圖片載入失敗)
            document.getElementById('modal-book-title-cover').textContent = item.title; 
            document.getElementById('modal-book-author').textContent = `作者：${item.author}`;
            document.getElementById('modal-book-quote').textContent = item.quote;

            // 2. 更新書封圖片
            const bookCoverImg = document.getElementById('modal-book-cover');
            const coverFallbackDiv = document.getElementById('cover-fallback');

            // 重置錯誤處理：先顯示圖片，隱藏備用
            bookCoverImg.style.display = 'block';
            coverFallbackDiv.style.display = 'none';

            // 設定圖片 URL
            bookCoverImg.src = item.coverUrl || 'https://placehold.co/128x192/f5f5f4/a8a29e?text=No+Cover'; 
            
            // 3. 更新連結與 QR Code
            const linkUrl = item.qrCodeLink;
            
            // 生成 QR Code 圖片
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(linkUrl)}`;
            document.getElementById('modal-qrcode').src = qrUrl;

            // 4. 顯示 Modal (使用 CSS class 控制顯示與動畫)
            const modal = document.getElementById('book-modal');
            const modalContent = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            // 強制重繪以觸發 transition
            void modal.offsetWidth; 
            
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
            
            document.body.style.overflow = 'hidden'; // 禁止背景滾動
        }

        // 關閉彈窗
        function closeModal() {
            const modal = document.getElementById('book-modal');
            const modalContent = document.getElementById('modal-content');
            
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            // 等待動畫結束後隱藏
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderMarket();
            lucide.createIcons();
            
            // 點擊 Modal 背景關閉
            document.getElementById('book-modal').addEventListener('click', (e) => {
                if (e.target.id === 'book-modal') {
                    closeModal();
                }
            });
        });

    </script>
</body>

</html>
